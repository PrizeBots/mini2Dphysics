r=(r,e)=>({x:r,y:e}),e=r=>i(r,r)**.5,t=(e,t)=>r(e.x+t.x,e.y+t.y),M=(r,e)=>t(r,f(e,-1)),f=(e,t)=>r(e.x*t,e.y*t),i=(r,e)=>r.x*e.x+r.y*e.y,V=(r,e)=>r.x*e.y-r.y*e.x,n=(e,t,a,M=e.x-t.x,f=e.y-t.y)=>r(M*Math.cos(a)-f*Math.sin(a)+t.x,M*Math.sin(a)+f*Math.cos(a)+t.y),o=r=>f(r,1/(e(r)||1)),N=(r(0,100),[]),B={},s={},C={},v=(r,e,a,M)=>{r.D=e,r.N=a,r.S=M,r.E=t(M,f(a,e))},x=(r,e,a)=>{if(r.C=t(r.C,e),r.T)for(a=4;a--;)r.X[a]=t(r.X[a],e)},y=(r,e,t)=>{if(r.G+=e,r.T){for(t=4;t--;)r.X[t]=n(r.X[t],r.C,e);h(r)}},X=(r,t)=>e(M(t.C,r.C))<=r.B+t.B,h=(r,e)=>{for(e=4;e--;)r.N[e]=o(M(r.X[(e+1)%4],r.X[(e+2)%4]))},A=(r,e,a)=>{var V,n,o,N,B,c,s=1e9,C=-1,x=1;for(n=0;x&&n<4;n++){V=r.N[n];var y,X,h=f(V,-1),A=r.X[n];for(c=-1e9,B=-1,o=4;o--;)y=M(e.X[o],A),(X=i(y,h))>0&&X>c&&(B=e.X[o],c=X);(x=-1!==B)&&c<s&&(s=c,C=n,N=B)}return x&&v(a,s,r.N[C],t(N,f(r.N[C],s))),x},T=(r,a,V)=>{if(!r.T&&!a.T){var n=M(a.C,r.C),N=r.B+a.B,c=e(n);if(c<=Math.sqrt(N*N)){var x=o(f(n,-1)),y=f(x,a.B);v(B,N-c,o(n),t(a.C,y))}return 1}if(r.T&&a.T){var X,h=0;return(X=A(r,a,s))&&(h=A(a,r,C))&&(s.D<C.D?v(B,s.D,s.N,M(s.S,f(s.N,s.D))):v(B,C.D,f(C.N,-1),C.S)),X&&h}if(!r.T&&a.T&&([r,a]=[a,r]),r.T&&!a.T){var T,l,D,I,u,S,g=1,E=-1e9,k=0;for(T=4;T--;){if(D=a.C,l=M(D,r.X[T]),(I=i(l,r.N[T]))>0){E=I,k=T,g=0;break}I>E&&(E=I,k=T)}if(g)v(B,a.B-E,r.N[k],M(D,f(r.N[k],a.B)));else{var R=M(D,r.X[k]),b=M(r.X[(k+1)%4],r.X[k]),d=i(R,b);if(d<0){if((u=e(R))>a.B)return;S=o(R),v(B,a.B-u,S,t(D,f(S,-a.B)))}else if(R=M(D,r.X[(k+1)%4]),b=f(b,-1),(d=i(R,b))<0){if((u=e(R))>a.B)return;S=o(R),v(B,a.B-u,S,t(D,f(S,-a.B)))}else{if(!(E<a.B))return;v(B,a.B-E,r.N[k],M(D,f(r.N[k],a.B)))}}return 1}},l=(e,a,n)=>{if(e.M||a.M){var N=n.D/(e.M+a.M)*.8,B=f(n.N,N),c=n.N;x(e,f(B,-e.M)),x(a,f(B,a.M));var s=f(n.S,a.M/(e.M+a.M)),C=f(n.E,e.M/(e.M+a.M)),v=t(s,C),y=M(v,e.C),X=M(v,a.C),h=t(e.V,r(-1*e.AV*y.y,e.AV*y.x)),A=t(a.V,r(-1*a.AV*X.y,a.AV*X.x)),T=M(A,h),l=i(T,c);if(!(l>0)){var D=Math.min(e.R,a.R),I=Math.min(e.F,a.F),u=V(y,c),S=V(X,c),g=-(1+D)*l/(e.M+a.M+u*u*e.I+S*S*a.I),E=f(c,g);e.V=M(e.V,f(E,e.M)),a.V=t(a.V,f(E,a.M)),e.AV-=u*g*e.I,a.AV+=S*g*a.I;var k=f(o(M(T,f(c,i(T,c)))),-1),R=V(y,k),b=V(X,k),d=-(1+D)*i(T,k)*I/(e.M+a.M+R*R*e.I+b*b*a.I);d>g&&(d=g),E=f(k,d),e.V=M(e.V,f(E,e.M)),a.V=t(a.V,f(E,a.M)),e.AV-=R*d*e.I,a.AV+=b*d*a.I}}};setInterval((r,e,V)=>{for(a.width^=0,V=9;V--;)for(r=N.length;r--;)for(e=N.length;e-->r;)X(N[r],N[e])&&T(N[r],N[e])&&(i(B.N,M(N[e].C,N[r].C))<0&&(B={D:B.D,N:f(B.N,-1),S:B.E,E:B.S}),l(N[r],N[e],B));for(r=N.length;r--;)c.save(),c.translate(N[r].C.x,N[r].C.y),c.rotate(N[r].G),N[r].T?c.strokeRect(-N[r].W/2,-N[r].H/2,N[r].W,N[r].H):(c.beginPath(),c.arc(0,0,N[r].B,0,7),c.lineTo(0,0),c.closePath(),c.stroke()),c.restore(),N[r].V=t(N[r].V,f(N[r].A,1/60)),x(N[r],f(N[r].V,1/60)),N[r].AV+=1*N[r].AA/60,y(N[r],1*N[r].AV/60)},16)