r=(r,a)=>({x:r,y:a}),e=r=>I(r,r)**.5,t=(a,e)=>r(a.x+e.x,a.y+e.y),A=(r,a)=>t(r,f(a,-1)),f=(a,e)=>r(a.x*e,a.y*e),I=(r,a)=>r.x*a.x+r.y*a.y,R=(r,a)=>r.x*a.y-r.y*a.x,C=(a,e,t,A=a.x-e.x,f=a.y-e.y)=>r(A*Math.cos(t)-f*Math.sin(t)+e.x,A*Math.sin(t)+f*Math.cos(t)+e.y),M=r=>f(r,1/(e(r)||1)),i=(r(0,100),[]),n={},o={},v={},V=(r,a,e,A)=>{r.D=a,r.N=e,r.S=A,r.E=t(A,f(e,a))},l=r=>{r.V=t(r.V,f(r.A,.016)),r.AV+=.016*r.AA,N(r,f(r.V,.016)),s(r,.016*r.AV)},N=(r,a)=>{if(r.C=t(r.C,a),"C"==r.T)r.SP=t(r.SP,a);else if("R"==r.T)for(var e=0;e<4;e++)r.X[e]=t(r.X[e],a)},s=(r,a)=>{if(r.AN+=a,"C"==r.T)r.SP=C(r.SP,r.C,a);else if("R"==r.T){for(var e=0;e<4;e++)r.X[e]=C(r.X[e],r.C,a);T(r)}},x=r=>{"C"==r.T?(c.beginPath(),c.arc(r.C.x,r.C.y,r.RA,0,7),c.moveTo(r.SP.x,r.SP.y),c.lineTo(r.C.x,r.C.y),c.closePath(),c.stroke()):"R"==r.T&&(c.save(),c.translate(r.X[0].x,r.X[0].y),c.rotate(r.AN),c.strokeRect(0,0,r.W,r.H),c.restore())},y=(r,a)=>e(A(a.C,r.C))<=r.B+a.B,T=r=>{for(var a=0;a<4;a++)r.N[a]=M(A(r.X[(a+1)%4],r.X[(a+2)%4]))},X=(r,a,e)=>{for(var R,C,M,i,n=999999,o=null,v=!0,l=0;v&&l<4;l++){R=r.N[l];var N,s,c=f(R,-1),x=r.X[l];i=-9999999,M=null;for(var y=0;y<4;y++)N=A(a.X[y],x),(s=I(N,c))>0&&s>i&&(M=a.X[y],i=s);(v=null!==M)&&i<n&&(n=i,o=l,C=M)}return v&&V(e,n,r.N[o],t(C,f(r.N[o],n))),v},h=(a,R,C)=>{if("C"===a.T&&"C"===R.T){var i=A(R.C,a.C),l=a.RA+R.RA,N=e(i);if(N>Math.sqrt(l*l))return!1;if(0!==N){var s=M(f(i,-1)),c=f(s,R.RA);V(n,l-N,M(i),t(R.C,c))}else a.RA>R.RA?V(n,l,r(0,-1),t(a.C,r(0,a.RA))):V(n,l,r(0,-1),t(R.C,r(0,R.RA)));return!0}if("R"===a.T&&"R"===R.T){var x,y=!1;return(x=X(a,R,o))&&(y=X(R,a,v))&&(o.D<v.D?V(n,o.D,o.N,A(o.S,f(o.N,o.D))):V(n,v.D,f(v.N,-1),v.S)),x&&y}if("C"===a.T&&"R"===R.T&&([a,R]=[R,a]),"R"===a.T&&"C"===R.T){var T,h,u,S,D,P,g=!0,E=-99999,k=0;for(T=0;T<4;T++){if(u=R.C,h=A(u,a.X[T]),(S=I(h,a.N[T]))>0){E=S,k=T,g=!1;break}S>E&&(E=S,k=T)}if(g)V(n,R.RA-E,a.N[k],A(u,f(a.N[k],R.RA)));else{var m=A(u,a.X[k]),b=A(a.X[(k+1)%4],a.X[k]),d=I(m,b);if(d<0){if((D=e(m))>R.RA)return!1;P=M(m),V(n,R.RA-D,P,t(u,f(P,-R.RA)))}else if(m=A(u,a.X[(k+1)%4]),b=f(b,-1),(d=I(m,b))<0){if((D=e(m))>R.RA)return!1;P=M(m),V(n,R.RA-D,P,t(u,f(P,-R.RA)))}else{if(!(E<R.RA))return!1;V(n,R.RA-E,a.N[k],A(u,f(a.N[k],R.RA)))}}return!0}},u=(a,e,C)=>{if(0!==a.IM||0!==e.IM){var i=C.D/(a.IM+e.IM)*.8,n=f(C.N,i);N(a,f(n,-a.IM)),N(e,f(n,e.IM));var o=C.N,v=f(C.S,e.IM/(a.IM+e.IM)),V=f(C.E,a.IM/(a.IM+e.IM)),l=t(v,V),s=A(l,a.C),c=A(l,e.C),x=t(a.V,r(-1*a.AV*s.y,a.AV*s.x)),y=t(e.V,r(-1*e.AV*c.y,e.AV*c.x)),T=A(y,x),X=I(T,o);if(!(X>0)){var h=Math.min(a.R,e.R),u=Math.min(a.F,e.F),S=R(s,o),D=R(c,o),P=-(1+h)*X;P/=a.IM+e.IM+S*S*a.I+D*D*e.I;var g=f(o,P);a.V=A(a.V,f(g,a.IM)),e.V=t(e.V,f(g,e.IM)),a.AV-=S*P*a.I,e.AV+=D*P*e.I;var E=A(T,f(o,I(T,o)));E=f(M(E),-1);var k=R(s,E),m=R(c,E),b=-(1+h)*I(T,E)*u;(b/=a.IM+e.IM+k*k*a.I+m*m*e.I)>P&&(b=P),g=f(E,b),a.V=A(a.V,f(g,a.IM)),e.V=t(e.V,f(g,e.IM)),a.AV-=k*b*a.I,e.AV+=m*b*e.I}}};setInterval(()=>{a.width^=0;for(var r=0;r<i.length;r++)x(i[r]);for(var e=0;e<15;e++)for(r=0;r<i.length;r++)for(var t=r+1;t<i.length;t++)y(i[r],i[t])&&h(i[r],i[t])&&(I(n.N,A(i[t].C,i[r].C))<0&&(n={D:n.D,N:f(n.N,-1),S:n.E,E:n.S}),u(i[r],i[t],n));for(r=0;r<i.length;r++)l(i[r])},16)