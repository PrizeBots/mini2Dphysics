c=a.getContext("2d");var e=(e,r)=>({x:e,y:r}),r=e=>l(e,e)**.5,t=(r,a)=>e(r.x+a.x,r.y+a.y),m=(e,r)=>t(e,o(r,-1)),o=(r,a)=>e(r.x*a,r.y*a),l=(e,r)=>e.x*r.x+e.y*r.y,n=(e,r)=>e.x*r.y-e.y*r.x,V=(r,a,t,m=r.x-a.x,o=r.y-a.y)=>e(m*Math.cos(t)-o*Math.sin(t)+a.x,m*Math.sin(t)+o*Math.cos(t)+a.y),x=e=>o(e,1/(r(e)||1)),i=e(0,100),N=[],M={},A={},I={},h=(e,r,a,m)=>{e.D=r,e.N=a,e.S=m,e.E=t(m,o(a,r))},F=e=>{M.N=o(M.N,-1),e=M.S,M.S=M.E,M.E=e},R=(r,a,t=.8,m=.2)=>{var o={};return o.C=r,o.I=0,o.F=t,o.R=m,o.V=e(0,0),o.IM=a?1/a:0,o.A=a?i:e(0,0),o.AN=0,o.AV=0,o.AA=0,o.B=0,N.push(o),o},C=e=>{var r=.016;e.V=t(e.V,o(e.A,r)),e.AV+=e.AA*r,"Circle"==e.T?(u(e,o(e.V,r)),y(e,e.AV*r)):"Rectangle"==e.T&&(s(e,o(e.V,r)),P(e,e.AV*r))},v=(e,a)=>!(r(m(a.C,e.C))>e.B+a.B),f=(r,a,t,o,l,c)=>{var n=R(r,o,l,c);return n.T="Rectangle",n.W=a,n.H=t,n.B=Math.hypot(a,t)/2,n.mVertex=[],n.mFaceNormal=[],n.mVertex[0]=e(r.x-a/2,r.y-t/2),n.mVertex[1]=e(r.x+a/2,r.y-t/2),n.mVertex[2]=e(r.x+a/2,r.y+t/2),n.mVertex[3]=e(r.x-a/2,r.y+t/2),n.mFaceNormal[0]=m(n.mVertex[1],n.mVertex[2]),n.mFaceNormal[0]=x(n.mFaceNormal[0]),n.mFaceNormal[1]=m(n.mVertex[2],n.mVertex[3]),n.mFaceNormal[1]=x(n.mFaceNormal[1]),n.mFaceNormal[2]=m(n.mVertex[3],n.mVertex[0]),n.mFaceNormal[2]=x(n.mFaceNormal[2]),n.mFaceNormal[3]=m(n.mVertex[0],n.mVertex[1]),n.mFaceNormal[3]=x(n.mFaceNormal[3]),d(n),n},u=(e,r)=>{e.SP=t(e.SP,r),e.C=t(e.C,r)},s=(e,r)=>{var a;for(a=0;a<e.mVertex.length;a++)e.mVertex[a]=t(e.mVertex[a],r);e.C=t(e.C,r)},S=e=>{c.beginPath(),c.arc(e.C.x,e.C.y,e.RA,0,7),c.moveTo(e.SP.x,e.SP.y),c.lineTo(e.C.x,e.C.y),c.closePath(),c.stroke()},p=e=>{c.save(),c.translate(e.mVertex[0].x,e.mVertex[0].y),c.rotate(e.AN),c.strokeRect(0,0,e.W,e.H),c.restore()},y=(e,r)=>{e.AN+=r,e.SP=V(e.SP,e.C,r)},P=(e,r)=>{var a;for(e.AN+=r,a=0;a<e.mVertex.length;a++)e.mVertex[a]=V(e.mVertex[a],e.C,r);e.mFaceNormal[0]=m(e.mVertex[1],e.mVertex[2]),e.mFaceNormal[0]=x(e.mFaceNormal[0]),e.mFaceNormal[1]=m(e.mVertex[2],e.mVertex[3]),e.mFaceNormal[1]=x(e.mFaceNormal[1]),e.mFaceNormal[2]=m(e.mVertex[3],e.mVertex[0]),e.mFaceNormal[2]=x(e.mFaceNormal[2]),e.mFaceNormal[3]=m(e.mVertex[0],e.mVertex[1]),e.mFaceNormal[3]=x(e.mFaceNormal[3])},T=e=>{e.I=e.IM?1/e.IM*(e.RA*e.RA)/12:0},d=e=>{0===e.IM?e.I=0:(e.I=1/e.IM*(e.W*e.W+e.H*e.H)/12,e.I=1/e.I)},g=new function(){this.mSupportPoint=null,this.mSupportPointDist=0},D=(e,r,a)=>{var t,o;g.mSupportPointDist=-9999999,g.mSupportPoint=null;for(var c=0;c<e.mVertex.length;c++)t=m(e.mVertex[c],a),(o=l(t,r))>0&&o>g.mSupportPointDist&&(g.mSupportPoint=e.mVertex[c],g.mSupportPointDist=o)},B=(e,r,a)=>{for(var m,l,c=999999,n=null,V=!0,x=0;V&&x<e.mFaceNormal.length;){m=e.mFaceNormal[x];var i=o(m,-1),N=e.mVertex[x];D(r,i,N),(V=null!==g.mSupportPoint)&&g.mSupportPointDist<c&&(c=g.mSupportPointDist,n=x,l=g.mSupportPoint),x++}if(V){var M=o(e.mFaceNormal[n],c);h(a,c,e.mFaceNormal[n],t(l,M))}return V},k=(e,a,c)=>{var n,V,i,N,M,A,I,F=!0,R=-99999,C=0;for(n=0;n<4;n++){if(i=a.C,V=m(i,e.mVertex[n]),(N=l(V,e.mFaceNormal[n]))>0){R=N,C=n,F=!1;break}N>R&&(R=N,C=n)}if(F)I=o(e.mFaceNormal[C],a.RA),h(c,a.RA-R,e.mFaceNormal[C],m(i,I));else{var v=m(i,e.mVertex[C]),f=m(e.mVertex[(C+1)%4],e.mVertex[C]),u=l(v,f);if(u<0){if((M=r(v))>a.RA)return!1;A=x(v),I=o(A,-a.RA),h(c,a.RA-M,A,t(i,I))}else if(v=m(i,e.mVertex[(C+1)%4]),f=o(f,-1),(u=l(v,f))<0){if((M=r(v))>a.RA)return!1;A=x(v),I=o(A,-a.RA),h(c,a.RA-M,A,t(i,I))}else{if(!(R<a.RA))return!1;I=o(e.mFaceNormal[C],a.RA),h(c,a.RA-R,e.mFaceNormal[C],m(i,I))}}return!0},E=(a,l,c)=>{if("Circle"===a.T&&"Circle"===l.T){var n=m(l.C,a.C),V=a.RA+l.RA,i=r(n);if(i>Math.sqrt(V*V))return!1;if(0!==i){var N=x(o(n,-1)),F=o(N,l.RA);h(M,V-i,x(n),t(l.C,F))}else a.RA>l.RA?h(M,V,e(0,-1),t(a.C,e(0,a.RA))):h(M,V,e(0,-1),t(l.C,e(0,l.RA)));return!0}if("Rectangle"===a.T&&"Rectangle"===l.T){var R,C=!1;if((R=B(a,l,A))&&(C=B(l,a,I)))if(A.D<I.D){var v=o(A.N,A.D);h(M,A.D,A.N,m(A.S,v))}else h(M,I.D,o(I.N,-1),I.S);return R&&C}return"Circle"===a.T&&"Rectangle"===l.T?k(l,a,M):"Rectangle"===a.T&&"Circle"===l.T?k(a,l,M):void 0},H=(r,a,c)=>{if(0!==r.IM||0!==a.IM){var V=r.IM,i=a.IM,N=c.D/(V+i)*.8,M=o(c.N,N);"Circle"==r.T?u(r,o(M,-V)):"Rectangle"==r.T&&s(r,o(M,-V)),"Circle"==a.T?u(a,o(M,i)):"Rectangle"==a.T&&s(a,o(M,i));var A=c.N,I=o(c.S,a.IM/(r.IM+a.IM)),h=o(c.E,r.IM/(r.IM+a.IM)),F=t(I,h),R=m(F,r.C),C=m(F,a.C),v=t(r.V,e(-1*r.AV*R.y,r.AV*R.x)),f=t(a.V,e(-1*a.AV*C.y,a.AV*C.x)),S=m(f,v),p=l(S,A);if(!(p>0)){var y=Math.min(r.R,a.R),P=Math.min(r.F,a.F),T=n(R,A),d=n(C,A),g=-(1+y)*p;g/=r.IM+a.IM+T*T*r.I+d*d*a.I;var D=o(A,g);r.V=m(r.V,o(D,r.IM)),a.V=t(a.V,o(D,a.IM)),r.AV-=T*g*r.I,a.AV+=d*g*a.I;var B=m(S,o(A,l(S,A)));B=o(x(B),-1);var k=n(R,B),E=n(C,B),H=-(1+y)*l(S,B)*P;(H/=r.IM+a.IM+k*k*r.I+E*E*a.I)>g&&(H=g),D=o(B,H),r.V=m(r.V,o(D,r.IM)),a.V=t(a.V,o(D,a.IM)),r.AV-=k*H*r.I,a.AV+=E*H*a.I}}},W=f(e(500,200),400,20,0,.3,0);P(W,2.8);f(e(200,400),400,20,0,1,.5),f(e(100,200),200,20,0),f(e(10,360),20,100,0,0,1);for(var b,w,q,j,z,G,J=0;J<10;J++){W=(b=e(800*Math.random(),450*Math.random()/2),w=20*Math.random()+10,q=30*Math.random(),j=Math.random(),z=Math.random(),G=void 0,(G=R(b,q,j,z)).T="Circle",G.RA=w,G.B=w,G.SP=e(b.x,b.y+w),T(G),G);y(W,7*Math.random());W=f(e(800*Math.random(),450*Math.random()/2),20*Math.random()+10,20*Math.random()+10,30*Math.random(),Math.random(),Math.random())}setInterval(()=>{a.width^=0;for(var e=0;e<N.length;e++)c.strokeStyle="#888","Circle"==N[e].T?S(N[e]):"Rectangle"==N[e].T&&p(N[e]);for(var r=0;r<15;r++)for(e=0;e<N.length;e++)for(var t=e+1;t<N.length;t++)v(N[e],N[t])&&E(N[e],N[t])&&(l(M.N,m(N[t].C,N[e].C))<0&&F(),H(N[e],N[t],M));for(e=0;e<N.length;e++)C(N[e])},16)