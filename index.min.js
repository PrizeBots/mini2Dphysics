r=(r,e)=>({x:r,y:e}),e=r=>f(r,r)**.5,t=(e,t)=>r(e.x+t.x,e.y+t.y),A=(r,e)=>t(r,I(e,-1)),I=(e,t)=>r(e.x*t,e.y*t),f=(r,e)=>r.x*e.x+r.y*e.y,M=(r,e)=>r.x*e.y-r.y*e.x,i=(e,t,A,a=e.x-t.x,I=e.y-t.y)=>r(a*Math.cos(A)-I*Math.sin(A)+t.x,a*Math.sin(A)+I*Math.cos(A)+t.y),n=r=>I(r,1/(e(r)||1)),V=(r(0,100),[]),o={},R={},N={},C=(r,e,A,a)=>{r.D=e,r.N=A,r.S=a,r.E=t(a,I(A,e))},s=r=>{r.V=t(r.V,I(r.A,.016)),r.AV+=.016*r.AA,v(r,I(r.V,.016)),h(r,.016*r.AV)},v=(r,e,A)=>{if(r.C=t(r.C,e),1==r.T)for(A=4;A--;)r.X[A]=t(r.X[A],e)},h=(r,e,t)=>{if(r.AN+=e,1==r.T){for(t=4;t--;)r.X[t]=i(r.X[t],r.C,e);X(r)}},x=r=>{c.save(),c.translate(r.C.x,r.C.y),c.rotate(r.AN),0==r.T?(c.beginPath(),c.arc(0,0,r.RA,0,7),c.lineTo(0,0),c.closePath(),c.stroke()):1==r.T&&c.strokeRect(-r.W/2,-r.H/2,r.W,r.H),c.restore()},y=(r,t)=>e(A(t.C,r.C))<=r.B+t.B,X=(r,e)=>{for(e=4;e--;)r.N[e]=n(A(r.X[(e+1)%4],r.X[(e+2)%4]))},l=(r,e,a)=>{var M,i,n,V,o,R,N=1e9,c=-1,s=!0;for(i=0;s&&i<4;i++){M=r.N[i];var v,h,x=I(M,-1),y=r.X[i];for(R=-1e9,o=-1,n=4;n--;)v=A(e.X[n],y),(h=f(v,x))>0&&h>R&&(o=e.X[n],R=h);(s=-1!==o)&&R<N&&(N=R,c=i,V=o)}return s&&C(a,N,r.N[c],t(V,I(r.N[c],N))),s},T=(a,M,i)=>{if(0==a.T&&0==M.T){var V=A(M.C,a.C),c=a.RA+M.RA,s=e(V);if(s>Math.sqrt(c*c))return!1;if(0!==s){var v=n(I(V,-1)),h=I(v,M.RA);C(o,c-s,n(V),t(M.C,h))}else a.RA>M.RA?C(o,c,r(0,-1),t(a.C,r(0,a.RA))):C(o,c,r(0,-1),t(M.C,r(0,M.RA)));return!0}if(1==a.T&&1==M.T){var x,y=!1;return(x=l(a,M,R))&&(y=l(M,a,N))&&(R.D<N.D?C(o,R.D,R.N,A(R.S,I(R.N,R.D))):C(o,N.D,I(N.N,-1),N.S)),x&&y}if(0==a.T&&1==M.T&&([a,M]=[M,a]),1==a.T&&0==M.T){var X,T,u,D,S,g,E=!0,k=-1e9,b=0;for(X=4;X--;){if(u=M.C,T=A(u,a.X[X]),(D=f(T,a.N[X]))>0){k=D,b=X,E=!1;break}D>k&&(k=D,b=X)}if(E)C(o,M.RA-k,a.N[b],A(u,I(a.N[b],M.RA)));else{var d=A(u,a.X[b]),m=A(a.X[(b+1)%4],a.X[b]),B=f(d,m);if(B<0){if((S=e(d))>M.RA)return!1;g=n(d),C(o,M.RA-S,g,t(u,I(g,-M.RA)))}else if(d=A(u,a.X[(b+1)%4]),m=I(m,-1),(B=f(d,m))<0){if((S=e(d))>M.RA)return!1;g=n(d),C(o,M.RA-S,g,t(u,I(g,-M.RA)))}else{if(!(k<M.RA))return!1;C(o,M.RA-k,a.N[b],A(u,I(a.N[b],M.RA)))}}return!0}},u=(e,a,i)=>{if(0!=e.IM||0!=a.IM){var V=i.D/(e.IM+a.IM)*.8,o=I(i.N,V),R=i.N;v(e,I(o,-e.IM)),v(a,I(o,a.IM));var N=I(i.S,a.IM/(e.IM+a.IM)),C=I(i.E,e.IM/(e.IM+a.IM)),c=t(N,C),s=A(c,e.C),h=A(c,a.C),x=t(e.V,r(-1*e.AV*s.y,e.AV*s.x)),y=t(a.V,r(-1*a.AV*h.y,a.AV*h.x)),X=A(y,x),l=f(X,R);if(!(l>0)){var T=Math.min(e.R,a.R),u=Math.min(e.F,a.F),D=M(s,R),S=M(h,R),g=-(1+T)*l;g/=e.IM+a.IM+D*D*e.I+S*S*a.I;var E=I(R,g);e.V=A(e.V,I(E,e.IM)),a.V=t(a.V,I(E,a.IM)),e.AV-=D*g*e.I,a.AV+=S*g*a.I;var k=A(X,I(R,f(X,R)));k=I(n(k),-1);var b=M(s,k),d=M(h,k),m=-(1+T)*f(X,k)*u;(m/=e.IM+a.IM+b*b*e.I+d*d*a.I)>g&&(m=g),E=I(k,m),e.V=A(e.V,I(E,e.IM)),a.V=t(a.V,I(E,a.IM)),e.AV-=b*m*e.I,a.AV+=d*m*a.I}}};setInterval((r,e,t)=>{for(a.width^=0,r=V.length;r--;)x(V[r]);for(t=0;t<15;t++)for(r=V.length;r--;)for(e=V.length;e-->r;)y(V[r],V[e])&&T(V[r],V[e])&&(f(o.N,A(V[e].C,V[r].C))<0&&(o={D:o.D,N:I(o.N,-1),S:o.E,E:o.S}),u(V[r],V[e],o));for(r=V.length;r--;)s(V[r])},16)