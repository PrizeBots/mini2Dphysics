c=a.getContext("2d");var r,t,e,n,M,o,A,I,h=(r,a)=>({x:r,y:a}),R=r=>v(r,r)**.5,C=(r,a)=>h(r.x+a.x,r.y+a.y),X=(r,a)=>C(r,f(a,-1)),f=(r,a)=>h(r.x*a,r.y*a),v=(r,a)=>r.x*a.x+r.y*a.y,i=(r,a)=>r.x*a.y-r.y*a.x,l=(r,a,t,e=r.x-a.x,n=r.y-a.y)=>h(e*Math.cos(t)-n*Math.sin(t)+a.x,e*Math.sin(t)+n*Math.cos(t)+a.y),N=r=>f(r,1/(R(r)||1)),V=h(0,100),y=[],x={},s={},d={},T=(r,a,t,e)=>{r.D=a,r.N=t,r.S=e,r.E=C(e,f(t,a))},m=(r,a,t=.8,e=.2)=>{var n={};return n.C=r,n.I=0,n.F=t,n.R=e,n.V=h(0,0),n.IM=a?1/a:0,n.A=a?V:h(0,0),n.AN=0,n.AV=0,n.AA=0,n.B=0,y.push(n),n},u=r=>{r.V=C(r.V,f(r.A,.016)),r.AV+=.016*r.AA,D(r,f(r.V,.016)),k(r,.016*r.AV)},S=(r,a)=>R(X(a.C,r.C))<=r.B+a.B,g=r=>{r.N[0]=N(X(r.X[1],r.X[2])),r.N[1]=N(X(r.X[2],r.X[3])),r.N[2]=N(X(r.X[3],r.X[0])),r.N[3]=N(X(r.X[0],r.X[1]))},P=(r,a,t,e,n,M)=>{var o=m(r,e,n,M);return o.T="R",o.W=a,o.H=t,o.B=Math.hypot(a,t)/2,o.X=[],o.N=[],o.X[0]=h(r.x-a/2,r.y-t/2),o.X[1]=h(r.x+a/2,r.y-t/2),o.X[2]=h(r.x+a/2,r.y+t/2),o.X[3]=h(r.x-a/2,r.y+t/2),g(o),o.I=o.IM>0?1/(1/o.IM*(o.W*o.W+o.H*o.H)/12):0,o},D=(r,a)=>{if(r.C=C(r.C,a),"C"==r.T)r.SP=C(r.SP,a);else if("R"==r.T)for(var t=0;t<r.X.length;t++)r.X[t]=C(r.X[t],a)},B=r=>{"C"==r.T?(c.beginPath(),c.arc(r.C.x,r.C.y,r.RA,0,7),c.moveTo(r.SP.x,r.SP.y),c.lineTo(r.C.x,r.C.y),c.closePath(),c.stroke()):"R"==r.T&&(c.save(),c.translate(r.X[0].x,r.X[0].y),c.rotate(r.AN),c.strokeRect(0,0,r.W,r.H),c.restore())},k=(r,a)=>{if(r.AN+=a,"C"==r.T)r.SP=l(r.SP,r.C,a);else if("R"==r.T){for(var t=0;t<r.X.length;t++)r.X[t]=l(r.X[t],r.C,a);g(r)}},E=(a,e,n)=>{var M,o;t=-9999999,r=null;for(var A=0;A<a.X.length;A++)M=X(a.X[A],n),(o=v(M,e))>0&&o>t&&(r=a.X[A],t=o)},H=(a,e,n)=>{for(var M,o,A=999999,I=null,h=!0,R=0;h&&R<a.N.length;R++){M=a.N[R];var X=f(M,-1),v=a.X[R];E(e,X,v),(h=null!==r)&&t<A&&(A=t,I=R,o=r)}return h&&T(n,A,a.N[I],C(o,f(a.N[I],A))),h},W=(r,a,t)=>{var e,n,M,o,A,I,h=!0,i=-99999,l=0;for(e=0;e<4;e++){if(M=a.C,n=X(M,r.X[e]),(o=v(n,r.N[e]))>0){i=o,l=e,h=!1;break}o>i&&(i=o,l=e)}if(h)T(t,a.RA-i,r.N[l],X(M,f(r.N[l],a.RA)));else{var V=X(M,r.X[l]),y=X(r.X[(l+1)%4],r.X[l]),x=v(V,y);if(x<0){if((A=R(V))>a.RA)return!1;I=N(V),T(t,a.RA-A,I,C(M,f(I,-a.RA)))}else if(V=X(M,r.X[(l+1)%4]),y=f(y,-1),(x=v(V,y))<0){if((A=R(V))>a.RA)return!1;I=N(V),T(t,a.RA-A,I,C(M,f(I,-a.RA)))}else{if(!(i<a.RA))return!1;T(t,a.RA-i,r.N[l],X(M,f(r.N[l],a.RA)))}}return!0},F=(r,a,t)=>{if("C"===r.T&&"C"===a.T){var e=X(a.C,r.C),n=r.RA+a.RA,M=R(e);if(M>Math.sqrt(n*n))return!1;if(0!==M){var o=N(f(e,-1)),A=f(o,a.RA);T(x,n-M,N(e),C(a.C,A))}else r.RA>a.RA?T(x,n,h(0,-1),C(r.C,h(0,r.RA))):T(x,n,h(0,-1),C(a.C,h(0,a.RA)));return!0}if("R"===r.T&&"R"===a.T){var I,v=!1;return(I=H(r,a,s))&&(v=H(a,r,d))&&(s.D<d.D?T(x,s.D,s.N,X(s.S,f(s.N,s.D))):T(x,d.D,f(d.N,-1),d.S)),I&&v}return"C"===r.T&&"R"===a.T?W(a,r,x):"R"===r.T&&"C"===a.T?W(r,a,x):void 0},b=(r,a,t)=>{if(0!==r.IM||0!==a.IM){var e=t.D/(r.IM+a.IM)*.8,n=f(t.N,e);D(r,f(n,-r.IM)),D(a,f(n,a.IM));var M=t.N,o=f(t.S,a.IM/(r.IM+a.IM)),A=f(t.E,r.IM/(r.IM+a.IM)),I=C(o,A),R=X(I,r.C),l=X(I,a.C),V=C(r.V,h(-1*r.AV*R.y,r.AV*R.x)),y=C(a.V,h(-1*a.AV*l.y,a.AV*l.x)),x=X(y,V),s=v(x,M);if(!(s>0)){var c=Math.min(r.R,a.R),d=Math.min(r.F,a.F),T=i(R,M),m=i(l,M),u=-(1+c)*s;u/=r.IM+a.IM+T*T*r.I+m*m*a.I;var S=f(M,u);r.V=X(r.V,f(S,r.IM)),a.V=C(a.V,f(S,a.IM)),r.AV-=T*u*r.I,a.AV+=m*u*a.I;var g=X(x,f(M,v(x,M)));g=f(N(g),-1);var P=i(R,g),B=i(l,g),k=-(1+c)*v(x,g)*d;(k/=r.IM+a.IM+P*P*r.I+B*B*a.I)>u&&(k=u),S=f(g,k),r.V=X(r.V,f(S,r.IM)),a.V=C(a.V,f(S,a.IM)),r.AV-=P*k*r.I,a.AV+=B*k*a.I}}};k(P(h(500,200),400,20,0,.3,0),2.8),P(h(200,400),400,20,0,1,.5),P(h(100,200),200,20,0),P(h(10,360),20,100,0,0,1);for(var p=0;p<10;p++)k((e=h(800*Math.random(),450*Math.random()/2),n=20*Math.random()+10,M=30*Math.random(),o=Math.random(),A=Math.random(),I=void 0,(I=m(e,M,o,A)).T="C",I.B=I.RA=n,I.SP=h(e.x,e.y+n),I.I=I.IM>0?1/I.IM*(I.RA*I.RA)/12:0,I),7*Math.random()),P(h(800*Math.random(),450*Math.random()/2),20*Math.random()+10,20*Math.random()+10,30*Math.random(),Math.random(),Math.random());setInterval(()=>{a.width^=0;for(var r=0;r<y.length;r++)c.strokeStyle="#888",B(y[r]);for(var t=0;t<15;t++)for(r=0;r<y.length;r++)for(var e=r+1;e<y.length;e++)S(y[r],y[e])&&F(y[r],y[e])&&(v(x.N,X(y[e].C,y[r].C))<0&&(x.N=f(x.N,-1),[x.S,x.E]=[x.E,x.S]),b(y[r],y[e],x));for(r=0;r<y.length;r++)u(y[r])},16)